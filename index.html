<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Just Keep Writing</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <h1>Just Keep Writing!</h1>
  <div class="controls">
    <label>
      Session Time:
      <select id="timeSelector">
        <option value="5">5 minutes</option>
        <option value="10" selected>10 minutes</option>
        <option value="25">25 minutes</option>
        <option value="60">60 minutes</option>
      </select>
    </label>

  <button id="startBtn">Start Writing</button>
  <label>
    Time limit:
    <select id="timeSelect">
      <option value="300">5 minutes</option>
      <option value="600" selected>10 minutes</option>
      <option value="1500">25 minutes</option>
      <option value="3600">30 minutes</option>
    </select>
  </label>
  <label>
    <input type="checkbox" id="disableWarning"> Disable warnings
  </label>
  <button id="resetBtn" style="display:none;">Reset</button>
</div>
    
    <label style="margin-left: 1em;">
      <input type="checkbox" id="concentrationMode" />
      Concentration Mode (no warnings)
    </label>

    <button id="resetButton">ðŸ”„ Reset</button>
  </div>

  <textarea id="writer" placeholder="Start writing..."></textarea>

  <div class="status">
    Words: <span id="wordCount">0</span> |
    Time left: <span id="timer">--</span>s
    <span id="warning" class="warning"></span>
  </div>

  <div class="status" id="summary"></div>

  <script>
  const textArea = document.getElementById('writing');
  const wordCountDisplay = document.getElementById('wordCount');
  const timeDisplay = document.getElementById('timeRemaining');
  const warningDisplay = document.getElementById('warning');
  const startBtn = document.getElementById('startBtn');
  const resetBtn = document.getElementById('resetBtn');
  const timeSelect = document.getElementById('timeSelect');
  const disableWarning = document.getElementById('disableWarning');
  const summary = document.getElementById('summary');

  let timer, remaining, startTime;
  let running = false;

  function countWords(text) {
    return (text.trim().match(/\b\w+\b/g) || []).length;
  }

  function updateStatus() {
    const words = countWords(textArea.value);
    wordCountDisplay.textContent = words;
  }

  function updateTime() {
    remaining--;
    const minutes = Math.floor(remaining / 60);
    const seconds = remaining % 60;
    timeDisplay.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;

    if (remaining <= 0) {
      clearInterval(timer);
      textArea.disabled = true;
      running = false;
      resetBtn.style.display = 'inline';
      const totalTime = (Date.now() - startTime) / 60000;
      const words = countWords(textArea.value);
      summary.textContent = `â± You wrote ${words} words in ${totalTime.toFixed(1)} minutes (${(words / totalTime).toFixed(1)} wpm).`;
    } else if (!disableWarning.checked && remaining <= 30) {
      warningDisplay.textContent = 'â³ Almost out of time!';
    } else {
      warningDisplay.textContent = '';
    }
  }

  startBtn.addEventListener('click', () => {
    if (running) return;
    remaining = parseInt(timeSelect.value, 10);
    startTime = Date.now();
    textArea.value = '';
    textArea.disabled = false;
    textArea.focus();
    timer = setInterval(() => {
      updateStatus();
      updateTime();
    }, 1000);
    running = true;
    summary.textContent = '';
    resetBtn.style.display = 'none';
    updateStatus();
    updateTime();
  });

  resetBtn.addEventListener('click', () => {
    textArea.value = '';
    wordCountDisplay.textContent = '0';
    timeDisplay.textContent = '';
    warningDisplay.textContent = '';
    summary.textContent = '';
    textArea.disabled = false;
    running = false;
  });

  textArea.addEventListener('input', updateStatus);

    function startSession() {
      typing = true;
      countdown = totalSeconds;
      idleTime = 0;
      textarea.disabled = false;
      textarea.value = '';
      textarea.focus();
      wordCount = 0;
      wordCountEl.textContent = 0;
      warningEl.textContent = '';
      summaryEl.textContent = '';
      startTime = Date.now();

      if (interval) clearInterval(interval);
      interval = setInterval(tick, 1000);
    }

    function tick() {
      if (typing) {
        countdown--;
        timerEl.textContent = countdown;
        if (countdown <= 0) {
          endSession();
        }
      }

      if (typing) {
        idleTime++;
        if (!concentrationMode.checked && idleTime >= idleLimit) {
          warningEl.textContent = 'Keep writing or else...';
        }
      }
    }

    function endSession() {
      clearInterval(interval);
      typing = false;
      textarea.disabled = true;
      warningEl.textContent = 'Time's up!';
      const endTime = Date.now();
      const durationMinutes = (endTime - startTime) / 60000;
      const finalWords = countWords(textarea.value);
      const wpm = Math.round(finalWords / durationMinutes);
      summaryEl.textContent = `You wrote ${finalWords} words at about ${wpm} words per minute.`;
    }

    textarea.addEventListener('input', () => {
      wordCount = countWords(textarea.value);
      wordCountEl.textContent = wordCount;
      typing = true;
      idleTime = 0;
      warningEl.textContent = '';
    });

    resetButton.addEventListener('click', () => {
      totalSeconds = parseInt(timeSelector.value, 10) * 60;
      timerEl.textContent = totalSeconds;
      startSession();
    });

    // Set initial time on load
    window.onload = () => {
      totalSeconds = parseInt(timeSelector.value, 10) * 60;
      timerEl.textContent = totalSeconds;
    };
  </script>

</body>
</html>
